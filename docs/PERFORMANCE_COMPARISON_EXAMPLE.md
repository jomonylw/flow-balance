# æ•°æ®å¯¼å…¥æ€§èƒ½å¯¹æ¯”ç¤ºä¾‹

## ğŸ” ä¼˜åŒ–å‰åå¯¹æ¯”

### åœºæ™¯ï¼šå¯¼å…¥ 5000 æ¡äº¤æ˜“è®°å½•

#### ä¼˜åŒ–å‰ï¼ˆé€æ¡æ’å…¥ï¼‰ï¼š

```typescript
// åŸæ¥çš„å®ç°
for (const transaction of transactions) {
  // 1. é€æ¡æŸ¥è¯¢è´§å¸ï¼ˆå¦‚æœç¼“å­˜æœªå‘½ä¸­ï¼‰
  const currency = await tx.currency.findFirst({
    where: { code: transaction.currencyCode },
  })

  // 2. é€æ¡åˆ›å»ºäº¤æ˜“
  const newTransaction = await tx.transaction.create({
    data: {
      /* äº¤æ˜“æ•°æ® */
    },
  })

  // 3. é€æ¡åˆ›å»ºæ ‡ç­¾å…³è”
  for (const tag of transaction.tags) {
    await tx.transactionTag.create({
      data: {
        transactionId: newTransaction.id,
        tagId: tag.id,
      },
    })
  }
}
```

**æ€§èƒ½è¡¨ç°ï¼š**

- æ•°æ®åº“æ“ä½œæ¬¡æ•°ï¼š5000 + 5000 + (æ ‡ç­¾æ•°é‡ Ã— 5000) â‰ˆ 25,000+ æ¬¡
- é¢„ä¼°è€—æ—¶ï¼š120-180 ç§’
- å†…å­˜ä½¿ç”¨ï¼šé«˜ï¼ˆé¢‘ç¹çš„æ•°æ®åº“å¾€è¿”ï¼‰

#### ä¼˜åŒ–åï¼ˆæ‰¹é‡æ’å…¥ï¼‰ï¼š

```typescript
// æ–°çš„å®ç°
// 1. é¢„å¤„ç†ï¼šæ‰¹é‡æŸ¥è¯¢ç¼ºå¤±çš„è´§å¸
const missingCurrencies = await tx.currency.findMany({
  where: { code: { in: uniqueCurrencyCodes } },
})

// 2. åˆ†æ‰¹å¤„ç†ï¼ˆ500æ¡/æ‰¹ï¼‰
for (let i = 0; i < transactions.length; i += 500) {
  const batch = transactions.slice(i, i + 500)

  // 3. æ‰¹é‡åˆ›å»ºäº¤æ˜“
  const createdTransactions = await tx.transaction.createManyAndReturn({
    data: validTransactions,
  })

  // 4. æ‰¹é‡åˆ›å»ºæ ‡ç­¾å…³è”
  await tx.transactionTag.createMany({
    data: tagAssociations,
  })
}
```

**æ€§èƒ½è¡¨ç°ï¼š**

- æ•°æ®åº“æ“ä½œæ¬¡æ•°ï¼š1 + 10 + 10 = 21 æ¬¡
- é¢„ä¼°è€—æ—¶ï¼š8-15 ç§’
- å†…å­˜ä½¿ç”¨ï¼šä½ï¼ˆæ‰¹é‡æ“ä½œï¼Œå‡å°‘å¾€è¿”ï¼‰

## ğŸ“Š æ€§èƒ½æå‡ç»Ÿè®¡

### å®é™…æµ‹è¯•ç»“æœï¼ˆæ¨¡æ‹Ÿï¼‰

| æ•°æ®é‡  | ä¼˜åŒ–å‰è€—æ—¶ | ä¼˜åŒ–åè€—æ—¶ | æå‡å€æ•° | æ•°æ®åº“æ“ä½œå‡å°‘ |
| ------- | ---------- | ---------- | -------- | -------------- |
| 100æ¡   | 3ç§’        | 0.8ç§’      | 3.75å€   | 95%            |
| 1000æ¡  | 25ç§’       | 3ç§’        | 8.33å€   | 96%            |
| 5000æ¡  | 150ç§’      | 12ç§’       | 12.5å€   | 97%            |
| 10000æ¡ | 320ç§’      | 20ç§’       | 16å€     | 98%            |

### å…³é”®ä¼˜åŒ–æŒ‡æ ‡

#### 1. æ•°æ®åº“æ“ä½œæ¬¡æ•°å‡å°‘

```
ä¼˜åŒ–å‰ï¼šO(n) æ¬¡æ“ä½œï¼ˆn = è®°å½•æ•°ï¼‰
ä¼˜åŒ–åï¼šO(n/batch_size) æ¬¡æ“ä½œ
å‡å°‘æ¯”ä¾‹ï¼š95-98%
```

#### 2. ç½‘ç»œå¾€è¿”æ¬¡æ•°å‡å°‘

```
ä¼˜åŒ–å‰ï¼šæ¯æ¡è®°å½• 3-5 æ¬¡å¾€è¿”
ä¼˜åŒ–åï¼šæ¯æ‰¹æ¬¡ 2-3 æ¬¡å¾€è¿”
å‡å°‘æ¯”ä¾‹ï¼š90-95%
```

#### 3. äº‹åŠ¡æ—¶é—´ç¼©çŸ­

```
ä¼˜åŒ–å‰ï¼šé•¿æ—¶é—´äº‹åŠ¡ï¼ˆå®¹æ˜“è¶…æ—¶ï¼‰
ä¼˜åŒ–åï¼šçŸ­æ—¶é—´æ‰¹é‡äº‹åŠ¡ï¼ˆç¨³å®šå¯é ï¼‰
```

## ğŸš€ å„æ•°æ®ç±»å‹ä¼˜åŒ–æ•ˆæœ

### 1. äº¤æ˜“è®°å½•ï¼ˆTransactionsï¼‰

- **ä¼˜åŒ–é‡ç‚¹**ï¼šæœ€å¤§çš„æ€§èƒ½ç“¶é¢ˆ
- **æ‰¹é‡å¤§å°**ï¼š500æ¡/æ‰¹
- **æ€§èƒ½æå‡**ï¼š10-20å€
- **ç‰¹æ®Šå¤„ç†**ï¼šæ ‡ç­¾å…³è”æ‰¹é‡åˆ›å»º

### 2. å®šæœŸäº¤æ˜“ï¼ˆRecurring Transactionsï¼‰

- **ä¼˜åŒ–é‡ç‚¹**ï¼šå‡å°‘è´§å¸æŸ¥è¯¢
- **æ‰¹é‡å¤§å°**ï¼šå…¨é‡æ‰¹å¤„ç†
- **æ€§èƒ½æå‡**ï¼š5-10å€
- **ç‰¹æ®Šå¤„ç†**ï¼štagIds JSONå­—æ®µå¤„ç†

### 3. è´·æ¬¾åˆçº¦ï¼ˆLoan Contractsï¼‰

- **ä¼˜åŒ–é‡ç‚¹**ï¼šå‡å°‘è´¦æˆ·å’Œè´§å¸æŸ¥è¯¢
- **æ‰¹é‡å¤§å°**ï¼šå…¨é‡æ‰¹å¤„ç†
- **æ€§èƒ½æå‡**ï¼š3-8å€
- **ç‰¹æ®Šå¤„ç†**ï¼šå¯é€‰è¿˜æ¬¾è´¦æˆ·å¤„ç†

### 4. è´·æ¬¾è¿˜æ¬¾è®°å½•ï¼ˆLoan Paymentsï¼‰

- **ä¼˜åŒ–é‡ç‚¹**ï¼šç®€åŒ–æ•°æ®ç»“æ„
- **æ‰¹é‡å¤§å°**ï¼šå…¨é‡æ‰¹å¤„ç†
- **æ€§èƒ½æå‡**ï¼š5-12å€
- **ç‰¹æ®Šå¤„ç†**ï¼šäº¤æ˜“IDåç»­æ›´æ–°æœºåˆ¶

## ğŸ’¡ ä¼˜åŒ–æŠ€å·§æ€»ç»“

### 1. é¢„å¤„ç†ç­–ç•¥

```typescript
// æ‰¹é‡æŸ¥è¯¢ç¼ºå¤±çš„å…³è”æ•°æ®
const missingCurrencyIds = new Set()
for (const item of items) {
  if (!mapping[item.currencyId]) {
    missingCurrencyIds.add(item.currencyCode)
  }
}

const currencies = await tx.currency.findMany({
  where: { code: { in: Array.from(missingCurrencyIds) } },
})
```

### 2. æ‰¹é‡æ“ä½œæ¨¡å¼

```typescript
// ä½¿ç”¨ createManyAndReturn è·å–åˆ›å»ºçš„è®°å½•ID
const created = await tx.table.createManyAndReturn({
  data: validItems,
})

// æ‰¹é‡åˆ›å»ºå…³è”å…³ç³»
await tx.relationTable.createMany({
  data: associations,
})
```

### 3. é”™è¯¯å¤„ç†å›é€€

```typescript
try {
  // å°è¯•æ‰¹é‡æ“ä½œ
  await batchOperation()
} catch (error) {
  // å›é€€åˆ°é€æ¡æ“ä½œï¼Œè·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯
  await fallbackOperation()
}
```

### 4. æ€§èƒ½ç›‘æ§

```typescript
const startTime = Date.now()
// æ‰§è¡Œæ“ä½œ
const duration = Date.now() - startTime
const rate = count / (duration / 1000)
console.log(`ğŸ“Š æ“ä½œ: ${count} æ¡ï¼Œè€—æ—¶ ${duration}msï¼Œé€Ÿç‡ ${rate} æ¡/ç§’`)
```

## ğŸ¯ æœ€ä½³å®è·µå»ºè®®

1. **ä¼˜å…ˆä¼˜åŒ–é«˜é¢‘æ“ä½œ**ï¼šäº¤æ˜“è®°å½•æ˜¯æœ€é‡è¦çš„ä¼˜åŒ–ç›®æ ‡
2. **åˆç†è®¾ç½®æ‰¹é‡å¤§å°**ï¼š500æ¡æ˜¯ä¸€ä¸ªè¾ƒå¥½çš„å¹³è¡¡ç‚¹
3. **å®ç°å›é€€æœºåˆ¶**ï¼šç¡®ä¿åœ¨æ‰¹é‡æ“ä½œå¤±è´¥æ—¶èƒ½å¤Ÿè·å¾—è¯¦ç»†é”™è¯¯ä¿¡æ¯
4. **æ·»åŠ æ€§èƒ½ç›‘æ§**ï¼šå®æ—¶äº†è§£å¯¼å…¥æ“ä½œçš„æ€§èƒ½è¡¨ç°
5. **ä½¿ç”¨ä¸“ç”¨è¿æ¥**ï¼šä¸ºå¤§é‡æ•°æ®å¯¼å…¥é…ç½®ä¸“é—¨çš„æ•°æ®åº“è¿æ¥
6. **é¢„å¤„ç†å…³è”æ•°æ®**ï¼šé¿å…åœ¨å¾ªç¯ä¸­è¿›è¡Œé‡å¤æŸ¥è¯¢

è¿™äº›ä¼˜åŒ–å°†æ˜¾è‘—æå‡æ•°æ®å¯¼å…¥çš„ç”¨æˆ·ä½“éªŒï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤§é‡æ•°æ®æ—¶ã€‚
