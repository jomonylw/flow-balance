# è´§å¸ç³»ç»Ÿä¼˜åŒ–å®ŒæˆæŠ¥å‘Š

## ğŸ“‹ ä¼˜åŒ–æ¦‚è§ˆ

åŸºäºå¯¹Flow
Balanceé¡¹ç›®è´§å¸ç³»ç»Ÿçš„å…¨é¢åˆ†æï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†æ ¸å¿ƒçš„è´§å¸æ˜¾ç¤ºå’Œæ±‡ç‡è½¬æ¢æœºåˆ¶ä¼˜åŒ–ï¼Œé‡ç‚¹è§£å†³äº†**æœªå……åˆ†åˆ©ç”¨UserDataContextä¸­ç”¨æˆ·è®¾ç½®ä¿¡æ¯**çš„é—®é¢˜ã€‚

## âœ… å·²å®Œæˆçš„ä¼˜åŒ–

### 1. åˆ›å»ºç»Ÿä¸€çš„è´§å¸æ ¼å¼åŒ–ç³»ç»Ÿ

#### æ–°å¢æ ¸å¿ƒHook

- **`src/hooks/useUserCurrencyFormatter.ts`** - åŸºäºç”¨æˆ·è®¾ç½®çš„ç»Ÿä¸€è´§å¸æ ¼å¼åŒ–Hook
  - `formatCurrency()` - æ™ºèƒ½è´§å¸æ ¼å¼åŒ–ï¼Œè‡ªåŠ¨ä½¿ç”¨ç”¨æˆ·è¯­è¨€è®¾ç½®
  - `getCurrencySymbol()` - ä»ç”¨æˆ·å¯ç”¨è´§å¸ä¸­è·å–ç¬¦å·
  - `getCurrencyInfo()` - è·å–å®Œæ•´è´§å¸ä¿¡æ¯
  - `getUserLocale()` - è·å–ç”¨æˆ·localeè®¾ç½®
  - `formatNumber()` - æ ¼å¼åŒ–æ•°å­—ï¼ˆä¸å¸¦è´§å¸ç¬¦å·ï¼‰

#### æ–°å¢æç¤ºç»„ä»¶

- **`src/components/ui/prompts/CurrencySetupPrompt.tsx`** - è´§å¸è®¾ç½®æç¤ºç»„ä»¶
  - å½“ç”¨æˆ·æœªè®¾ç½®æœ¬ä½å¸æ—¶æ˜¾ç¤ºå¼•å¯¼æç¤º
  - æ”¯æŒä¸»é¢˜åˆ‡æ¢å’Œå›½é™…åŒ–
  - æä¾›å†…è”ç‰ˆæœ¬ç”¨äºä¸åŒåœºæ™¯

### 2. ç§»é™¤é‡å¤çš„è´§å¸ç¬¦å·æ˜ å°„

#### å·²ä¼˜åŒ–çš„ç»„ä»¶

1. **`BalanceSheetCard.tsx`** âœ…

   - åˆ é™¤é‡å¤çš„ `getCurrencySymbol` å‡½æ•°ï¼ˆ21ç§è´§å¸æ˜ å°„ï¼‰
   - åˆ é™¤é‡å¤çš„ `formatCurrency` å‡½æ•°
   - ç»Ÿä¸€ä½¿ç”¨ `useUserCurrencyFormatter` Hook
   - ç§»é™¤ç¡¬ç¼–ç çš„ 'zh-CN' localeï¼Œä½¿ç”¨ç”¨æˆ·è¯­è¨€è®¾ç½®
   - æ·»åŠ æœ¬ä½å¸ç¼ºå¤±æ£€æŸ¥å’Œæç¤º

2. **`CashFlowCard.tsx`** âœ…
   - åˆ é™¤é‡å¤çš„ `getCurrencySymbol` å‡½æ•°ï¼ˆç›¸åŒçš„21ç§è´§å¸æ˜ å°„ï¼‰
   - åˆ é™¤é‡å¤çš„ `formatCurrency` å‡½æ•°
   - ç»Ÿä¸€ä½¿ç”¨ `useUserCurrencyFormatter` Hook
   - ç§»é™¤æ‰€æœ‰ç¡¬ç¼–ç çš„ 'zh-CN' locale
   - æ·»åŠ æœ¬ä½å¸ç¼ºå¤±æ£€æŸ¥å’Œæç¤º

### 3. ç§»é™¤ç¡¬ç¼–ç é»˜è®¤è´§å¸

#### å·²ä¼˜åŒ–çš„ç»„ä»¶

1. **`QuickBalanceUpdateModal.tsx`** âœ…
   - ç§»é™¤ç¡¬ç¼–ç çš„é»˜è®¤è´§å¸ `{ code: 'CNY', symbol: 'Â¥', name: 'äººæ°‘å¸' }`
   - ä¼˜å…ˆä½¿ç”¨ `getBaseCurrency()` è·å–ç”¨æˆ·è®¾ç½®çš„æœ¬ä½å¸
   - æ·»åŠ æœ¬ä½å¸ç¼ºå¤±æ—¶çš„æç¤ºç•Œé¢
   - ä½¿ç”¨ç»Ÿä¸€çš„è´§å¸æ ¼å¼åŒ–é€»è¾‘

### 4. ç»Ÿä¸€è¯­è¨€è®¾ç½®çš„ä½¿ç”¨

#### å·²ä¼˜åŒ–çš„ç»„ä»¶

1. **`TransactionList.tsx`** âœ…

   - é‡æ„ `getAmountDisplay` å‡½æ•°ï¼Œä½¿ç”¨ç»Ÿä¸€çš„ `formatCurrency`
   - ç§»é™¤ç¡¬ç¼–ç çš„ 'zh-CN' locale
   - åŸºäºç”¨æˆ·è¯­è¨€è®¾ç½®åŠ¨æ€ç¡®å®šlocale

2. **`TransactionStats.tsx`** âœ…

   - æ›¿æ¢æ‰€æœ‰ç¡¬ç¼–ç çš„ 'zh-CN' locale
   - ä½¿ç”¨ `formatNumber` è¿›è¡Œæ•°å­—æ ¼å¼åŒ–
   - åŸºäºç”¨æˆ·è¯­è¨€è®¾ç½®è¿›è¡Œæœ¬åœ°åŒ–

3. **`LoanPaymentHistory.tsx`** âœ…

   - é‡æ„ `formatAmount` å‡½æ•°ï¼Œä½¿ç”¨ç»Ÿä¸€çš„ `formatCurrency`
   - ç§»é™¤ `Intl.NumberFormat` çš„ç¡¬ç¼–ç locale
   - ç»Ÿä¸€è´§å¸æ ¼å¼åŒ–æ ‡å‡†

4. **`ExchangeRateList.tsx`** âœ…

   - æ›´æ–° `formatDate` å‡½æ•°ï¼Œä½¿ç”¨ç”¨æˆ·localeè®¾ç½®
   - æ›´æ–° `formatRate` å‡½æ•°ï¼Œä½¿ç”¨ç»Ÿä¸€çš„ `formatNumber`
   - ç§»é™¤ç¡¬ç¼–ç çš„ 'zh-CN' locale

5. **`RecurringTransactionsList.tsx`** âœ…

   - ä½¿ç”¨ `formatCurrency` æ›¿ä»£ `toLocaleString`
   - ç»Ÿä¸€è´§å¸é‡‘é¢æ˜¾ç¤ºæ ¼å¼

6. **FlowCategorySummaryCard.tsx** âœ…

   - åˆ é™¤é‡å¤çš„ `getCurrencySymbol` å‡½æ•°ï¼ˆ23ç§è´§å¸æ˜ å°„ï¼‰
   - æ›¿æ¢æ‰€æœ‰ç¡¬ç¼–ç çš„ 'zh-CN' locale
   - ä½¿ç”¨ `formatNumber` è¿›è¡Œæ•°å­—æ ¼å¼åŒ–
   - ç»Ÿä¸€ä½¿ç”¨ `useUserCurrencyFormatter` Hook

7. **StockAccountTrendChart.tsx** âœ…
   - åˆ é™¤é‡å¤çš„ `getCurrencySymbol` å‡½æ•°ï¼ˆ23ç§è´§å¸æ˜ å°„ï¼‰
   - å›¾è¡¨å·¥å…·æç¤ºå’ŒYè½´æ ‡ç­¾ä½¿ç”¨ç”¨æˆ·è¯­è¨€è®¾ç½®
   - ç»Ÿä¸€è´§å¸ç¬¦å·è·å–é€»è¾‘
   - ä½¿ç”¨ `getUserLocale` æ›¿ä»£ç¡¬ç¼–ç locale

### 5. å›¾è¡¨ç»„ä»¶å…¨é¢ä¼˜åŒ–

#### å·²ä¼˜åŒ–çš„å›¾è¡¨ç»„ä»¶

1. **`MonthlySummaryChart.tsx`** âœ…

   - å·¥å…·æç¤ºæ ¼å¼åŒ–ä½¿ç”¨ç»Ÿä¸€çš„ `formatCurrency`
   - Yè½´æ ‡ç­¾ä½¿ç”¨ç”¨æˆ·è¯­è¨€è®¾ç½®çš„locale
   - ç»Ÿè®¡ä¿¡æ¯æ˜¾ç¤ºä½¿ç”¨ç»Ÿä¸€æ ¼å¼åŒ–
   - ç§»é™¤æ‰€æœ‰ç¡¬ç¼–ç çš„ 'zh-CN' locale

2. **`StockMonthlySummaryChart.tsx`** âœ…

   - å·¥å…·æç¤ºæ ¼å¼åŒ–ä½¿ç”¨ç»Ÿä¸€çš„ `formatCurrency`
   - Yè½´æ ‡ç­¾ä½¿ç”¨ç”¨æˆ·è¯­è¨€è®¾ç½®çš„locale
   - ç§»é™¤ç¡¬ç¼–ç çš„ 'en-US' locale

3. **`FlowMonthlySummaryChart.tsx`** âœ…

   - å·¥å…·æç¤ºæ ¼å¼åŒ–ä½¿ç”¨ç»Ÿä¸€çš„ `formatCurrency`
   - Yè½´æ ‡ç­¾ä½¿ç”¨ç”¨æˆ·è¯­è¨€è®¾ç½®çš„locale
   - ç§»é™¤ç¡¬ç¼–ç çš„ 'en-US' locale

4. **`FlowAccountTrendChart.tsx`** âœ…

   - å·¥å…·æç¤ºæ ¼å¼åŒ–ä½¿ç”¨ç»Ÿä¸€çš„ `formatCurrency`
   - Yè½´æ ‡ç­¾ä½¿ç”¨ç”¨æˆ·è¯­è¨€è®¾ç½®çš„locale
   - ç§»é™¤ç¡¬ç¼–ç çš„ 'en-US' locale

5. **`CashFlowChart.tsx`** âœ…
   - å·¥å…·æç¤ºæ ¼å¼åŒ–ä½¿ç”¨ç»Ÿä¸€çš„ `formatCurrency`
   - Yè½´æ ‡ç­¾ä½¿ç”¨ç”¨æˆ·è¯­è¨€è®¾ç½®çš„locale
   - ç§»é™¤ç¡¬ç¼–ç çš„ 'en-US' locale

### 6. æ¨¡æ€ç»„ä»¶ä¼˜åŒ–

#### å·²ä¼˜åŒ–çš„æ¨¡æ€ç»„ä»¶

1. **`BalanceUpdateModal.tsx`** âœ…
   - å½“å‰ä½™é¢æ˜¾ç¤ºä½¿ç”¨ç»Ÿä¸€çš„ `formatCurrency`
   - ç§»é™¤ç¡¬ç¼–ç çš„ 'zh-CN' locale
   - ç»Ÿä¸€è´§å¸æ ¼å¼åŒ–æ ‡å‡†

### 7. å¸ƒå±€ç»„ä»¶ä¼˜åŒ–

#### å·²ä¼˜åŒ–çš„å¸ƒå±€ç»„ä»¶

1. **`TypeGroupHeader.tsx`** âœ…
   - é‡‘é¢æ ¼å¼åŒ–ä½¿ç”¨ç”¨æˆ·è¯­è¨€è®¾ç½®çš„locale
   - ç§»é™¤ç¡¬ç¼–ç çš„ 'zh-CN' locale

### 8. å·¥å…·å‡½æ•°æ ‡è®°

#### å·²æ ‡è®°å¼ƒç”¨çš„å‡½æ•°

1. **`src/lib/utils/format.ts`** âœ…

   - æ·»åŠ å¼ƒç”¨æ³¨é‡Šï¼Œå»ºè®®ä½¿ç”¨ `useUserCurrencyFormatter` Hook
   - ä¿ç•™å‘åå…¼å®¹æ€§

2. **`src/lib/services/currency.service.ts`** âœ…
   - æ·»åŠ å¼ƒç”¨æ³¨é‡Šï¼Œå»ºè®®ä½¿ç”¨ `useUserCurrencyFormatter` Hook
   - ä¿ç•™å‘åå…¼å®¹æ€§

### 9. å›½é™…åŒ–æ–‡æœ¬è¡¥å……

#### å·²æ·»åŠ çš„å›½é™…åŒ–æ–‡æœ¬

- **ä¸­æ–‡ (`public/locales/zh/currency.json`)**:

  - `currency.setup.required`: "éœ€è¦è®¾ç½®æœ¬ä½å¸"
  - `currency.setup.description`: "è¯·å…ˆè®¾ç½®æ‚¨çš„æœ¬ä½å¸ï¼Œä»¥ä¾¿æ­£ç¡®æ˜¾ç¤ºé‡‘é¢å’Œè¿›è¡Œè´§å¸è½¬æ¢ã€‚"
  - `currency.setup.action`: "å‰å¾€è®¾ç½®"
  - `currency.setup.inline`: "è¯·å…ˆè®¾ç½®æœ¬ä½å¸"

- **è‹±æ–‡ (`public/locales/en/currency.json`)**:
  - `currency.setup.required`: "Base Currency Setup Required"
  - `currency.setup.description`: "Please set your base currency first to properly display amounts
    and perform currency conversions."
  - `currency.setup.action`: "Go to Settings"
  - `currency.setup.inline`: "Please set base currency first"

## ğŸ¯ ä¼˜åŒ–æ•ˆæœ

### 1. æ•°æ®ä¸€è‡´æ€§æå‡

- âœ… æ‰€æœ‰è´§å¸ç¬¦å·æ¥è‡ªUserDataContextä¸­çš„currenciesæ•°æ®
- âœ… æ ¼å¼åŒ–æ ‡å‡†ç»Ÿä¸€ï¼ŒåŸºäºç”¨æˆ·è¯­è¨€åå¥½
- âœ… æ¶ˆé™¤äº†ç¡¬ç¼–ç ä¸ç”¨æˆ·è®¾ç½®ä¸ä¸€è‡´çš„é—®é¢˜

### 2. ç”¨æˆ·ä½“éªŒæ”¹å–„

- âœ… ä¸ªæ€§åŒ–æ˜¾ç¤ºï¼šåŸºäºç”¨æˆ·è¯­è¨€å’Œæœ¬ä½å¸è®¾ç½®
- âœ… è®¾ç½®ç¼ºå¤±æç¤ºï¼šå¼•å¯¼ç”¨æˆ·å®Œæˆå¿…è¦çš„è®¾ç½®
- âœ… ä¸€è‡´æ€§ï¼šæ•´ä¸ªåº”ç”¨çš„è´§å¸æ˜¾ç¤ºé£æ ¼ç»Ÿä¸€

### 3. ä»£ç è´¨é‡æå‡

- âœ… æ¶ˆé™¤é‡å¤ä»£ç ï¼šç§»é™¤5å¤„é‡å¤çš„è´§å¸ç¬¦å·æ˜ å°„ï¼ˆå…±115è¡Œé‡å¤ä»£ç ï¼‰
- âœ… ç»Ÿä¸€APIï¼šæ‰€æœ‰ç»„ä»¶ä½¿ç”¨ç›¸åŒçš„æ ¼å¼åŒ–é€»è¾‘
- âœ… æ˜“äºç»´æŠ¤ï¼šè´§å¸ç›¸å…³é€»è¾‘é›†ä¸­ç®¡ç†
- âœ… å›¾è¡¨ç»„ä»¶ç»Ÿä¸€ï¼šæ‰€æœ‰EChartsç»„ä»¶ä½¿ç”¨ä¸€è‡´çš„è´§å¸æ ¼å¼åŒ–
- âœ… æ¨¡æ€ç»„ä»¶ä¼˜åŒ–ï¼šå…³é”®æ¨¡æ€ç»„ä»¶è´§å¸æ˜¾ç¤ºç»Ÿä¸€

### 4. å¼€å‘æ•ˆç‡æå‡

- âœ… ç®€åŒ–å¼€å‘ï¼šç»Ÿä¸€çš„è´§å¸å¤„ç†API
- âœ… å‡å°‘é”™è¯¯ï¼šé¿å…ç¡¬ç¼–ç å¯¼è‡´çš„ä¸ä¸€è‡´
- âœ… å“åº”å¼æ›´æ–°ï¼šç”¨æˆ·è®¾ç½®å˜æ›´è‡ªåŠ¨åæ˜ åˆ°æ ¼å¼åŒ–é€»è¾‘

## ğŸ“Š ä¼˜åŒ–ç»Ÿè®¡

### ä»£ç å˜æ›´ç»Ÿè®¡

- **æ–°å¢æ–‡ä»¶**: 2ä¸ª
  - `src/hooks/useUserCurrencyFormatter.ts`
  - `src/components/ui/prompts/CurrencySetupPrompt.tsx`
- **ä¿®æ”¹æ–‡ä»¶**: 19ä¸ª
  - `BalanceSheetCard.tsx`
  - `CashFlowCard.tsx`
  - `QuickBalanceUpdateModal.tsx`
  - `TransactionList.tsx`
  - `TransactionStats.tsx`
  - `LoanPaymentHistory.tsx`
  - `ExchangeRateList.tsx`
  - `RecurringTransactionsList.tsx`
  - `FlowCategorySummaryCard.tsx`
  - `StockAccountTrendChart.tsx`
  - `MonthlySummaryChart.tsx`
  - `StockMonthlySummaryChart.tsx`
  - `FlowMonthlySummaryChart.tsx`
  - `FlowAccountTrendChart.tsx`
  - `CashFlowChart.tsx`
  - `BalanceUpdateModal.tsx`
  - `TypeGroupHeader.tsx`
  - `src/lib/utils/format.ts` (æ ‡è®°å¼ƒç”¨)
  - `src/lib/services/currency.service.ts` (æ ‡è®°å¼ƒç”¨)
  - å›½é™…åŒ–æ–‡ä»¶ (zh/en currency.json)

### ç§»é™¤çš„é‡å¤ä»£ç 

- **è´§å¸ç¬¦å·æ˜ å°„**: 5å¤„é‡å¤å®šä¹‰ï¼Œæ¯å¤„21-23ç§è´§å¸
- **æ ¼å¼åŒ–å‡½æ•°**: å¤šä¸ªé‡å¤çš„è´§å¸æ ¼å¼åŒ–é€»è¾‘
- **ç¡¬ç¼–ç locale**: 50+å¤„ç¡¬ç¼–ç çš„ 'zh-CN'ã€'en-US'
- **ç¡¬ç¼–ç é»˜è®¤è´§å¸**: 1å¤„ç¡¬ç¼–ç çš„CNYé»˜è®¤å€¼

## ğŸ”„ åç»­ä¼˜åŒ–å»ºè®®

### ä½ä¼˜å…ˆçº§ï¼ˆé•¿æœŸæ”¹è¿›ï¼‰

1. **æ€§èƒ½ä¼˜åŒ–**

   - å®ç°æ±‡ç‡ç¼“å­˜æœºåˆ¶
   - ä¼˜åŒ–æ‰¹é‡è´§å¸è½¬æ¢æ“ä½œ
   - å›¾è¡¨ç»„ä»¶æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–

2. **å¢å¼ºåŠŸèƒ½**

   - è´§å¸é…ç½®å¯è§†åŒ–ç®¡ç†
   - å®æ—¶æ±‡ç‡APIé›†æˆ
   - è´§å¸è½¬æ¢å†å²è®°å½•
   - æ›´å¤šå›¾è¡¨ç±»å‹çš„è´§å¸æ ¼å¼åŒ–æ”¯æŒ

3. **ä»£ç æ¸…ç†**
   - å®Œå…¨ç§»é™¤å·²å¼ƒç”¨çš„å·¥å…·å‡½æ•°
   - è¿›ä¸€æ­¥ç»Ÿä¸€è´§å¸ç›¸å…³ç±»å‹å®šä¹‰
   - ä¼˜åŒ–è´§å¸æ ¼å¼åŒ–æ€§èƒ½

## ğŸ‰ æ€»ç»“

æœ¬æ¬¡ä¼˜åŒ–æˆåŠŸè§£å†³äº†Flow Balanceé¡¹ç›®ä¸­è´§å¸ç³»ç»Ÿçš„æ ¸å¿ƒé—®é¢˜ï¼š

1. **ç»Ÿä¸€äº†æ•°æ®æº** - æ‰€æœ‰è´§å¸ä¿¡æ¯ä¼˜å…ˆä½¿ç”¨UserDataContext
2. **æ¶ˆé™¤äº†é‡å¤ä»£ç ** - ç§»é™¤äº†å¤§é‡é‡å¤çš„è´§å¸ç¬¦å·æ˜ å°„å’Œæ ¼å¼åŒ–é€»è¾‘
3. **æå‡äº†ç”¨æˆ·ä½“éªŒ** - çœŸæ­£å®ç°äº†åŸºäºç”¨æˆ·è®¾ç½®çš„ä¸ªæ€§åŒ–æ˜¾ç¤º
4. **æ”¹å–„äº†ä»£ç è´¨é‡** - å»ºç«‹äº†ç»Ÿä¸€ã€å¯ç»´æŠ¤çš„è´§å¸å¤„ç†æœºåˆ¶

è¿™äº›ä¼˜åŒ–ä¸ºé¡¹ç›®å»ºç«‹äº†åšå®çš„è´§å¸ç³»ç»ŸåŸºç¡€ï¼Œä¸ºåç»­åŠŸèƒ½å¼€å‘æä¾›äº†ç»Ÿä¸€ã€å¯é çš„è´§å¸å¤„ç†èƒ½åŠ›ã€‚
