# 左侧树状菜单修改测试

## 测试目标

1. **重命名功能优化**：验证右键菜单中的重命名选项已被移除，只能通过设置模态框进行重命名
2. **顶级类型设置安全性**：验证顶级分类类型变更时的安全检查机制

## 测试步骤

### 1. 重命名功能测试

#### 1.1 分类重命名测试

- [ ] 右键点击任意分类
- [ ] 确认右键菜单中**没有**"重命名"选项
- [ ] 点击"设置"选项
- [ ] 在设置模态框中修改分类名称
- [ ] 确认可以成功保存

#### 1.2 账户重命名测试

- [ ] 右键点击任意账户
- [ ] 确认右键菜单中**没有**"重命名"选项
- [ ] 点击"设置"选项
- [ ] 在设置模态框中修改账户名称
- [ ] 确认可以成功保存

### 2. 顶级类型设置安全性测试

#### 2.1 空分类类型变更测试（应该成功）

- [ ] 创建一个新的顶级分类
- [ ] 不添加任何子分类或账户
- [ ] 右键点击该分类，选择"设置"
- [ ] 尝试变更分类类型
- [ ] 确认显示"✅ 可以安全变更类型"
- [ ] 确认可以成功保存

#### 2.2 有账户的分类类型变更测试（应该被阻止）

- [ ] 选择一个已有账户的顶级分类
- [ ] 右键点击该分类，选择"设置"
- [ ] 尝试变更分类类型
- [ ] 确认显示"🚫 无法变更类型"或"⚠️ 类型变更存在风险"
- [ ] 确认显示相关账户和交易数据的统计信息
- [ ] 尝试保存，确认被阻止并显示错误信息

#### 2.3 有交易记录的分类类型变更测试（应该被阻止）

- [ ] 选择一个有交易记录的顶级分类
- [ ] 右键点击该分类，选择"设置"
- [ ] 尝试变更分类类型
- [ ] 确认显示风险警告信息
- [ ] 特别关注是否显示余额调整记录的数量
- [ ] 尝试保存，确认被阻止

## 预期结果

### 重命名功能

- ✅ 右键菜单中不再有重命名选项
- ✅ 设置模态框中可以正常修改名称
- ✅ 用户界面更加简洁统一

### 类型设置安全性

- ✅ 空分类可以安全变更类型
- ✅ 有数据的分类会显示详细的风险评估
- ✅ 危险的类型变更会被阻止
- ✅ 用户能够清楚了解变更的风险和后果

## 技术实现验证

### API端点测试

- [ ] `/api/categories/[categoryId]/check-type-change` - 类型变更安全检查
- [ ] `/api/categories/[categoryId]` PUT - 类型变更时的后端验证

### 前端组件测试

- [ ] `CategoryContextMenu` - 确认移除了重命名选项
- [ ] `AccountContextMenu` - 确认移除了重命名选项
- [ ] `CategorySettingsModal` - 确认增加了类型变更安全检查
- [ ] 类型变更检查的UI反馈正常显示

## 注意事项

1. 测试时请使用不同类型的分类（资产、负债、收入、支出）
2. 测试时请确保有一些分类包含账户和交易数据
3. 注意观察加载状态和错误提示的显示
4. 确认所有的国际化文本都能正常显示
