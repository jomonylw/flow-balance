# ğŸ’³ äº¤æ˜“è®°å½•æ‹†åˆ†å¯¼å…¥åŠŸèƒ½å®ç°

## ğŸ¯ **åŠŸèƒ½æ¦‚è¿°**

æ ¹æ®ç”¨æˆ·éœ€æ±‚ï¼Œå°†åŸæ¥çš„å•ä¸€"äº¤æ˜“è®°å½•"é€‰é¡¹æ‹†åˆ†ä¸ºä¸‰ä¸ªç‹¬ç«‹çš„é€‰é¡¹ï¼š

1. **æ‰‹åŠ¨äº¤æ˜“** - ç”¨æˆ·ç›´æ¥åˆ›å»ºçš„äº¤æ˜“è®°å½•
2. **å®šæœŸäº¤æ˜“è®°å½•** - ç”±å®šæœŸäº¤æ˜“è§„åˆ™è‡ªåŠ¨ç”Ÿæˆçš„äº¤æ˜“è®°å½•
3. **è´·æ¬¾ç›¸å…³äº¤æ˜“** - è´·æ¬¾å‘æ”¾ã€è¿˜æ¬¾ç­‰ç›¸å…³çš„äº¤æ˜“è®°å½•

## ğŸ”§ **æŠ€æœ¯å®ç°**

### **1. ç±»å‹å®šä¹‰æ‰©å±•**

#### **ImportDataTypeSelection æ¥å£**

```typescript
export interface ImportDataTypeSelection {
  categories?: boolean
  accounts?: boolean
  manualTransactions?: boolean // ğŸ†• æ‰‹åŠ¨äº¤æ˜“
  recurringTransactionRecords?: boolean // ğŸ†• å®šæœŸäº¤æ˜“è®°å½•
  loanTransactionRecords?: boolean // ğŸ†• è´·æ¬¾ç›¸å…³äº¤æ˜“
  tags?: boolean
  currencies?: boolean
  exchangeRates?: boolean
  transactionTemplates?: boolean
  recurringTransactions?: boolean
  loanContracts?: boolean
  loanPayments?: boolean
}
```

#### **ExportStatistics æ¥å£**

```typescript
export interface ExportStatistics {
  // åŸæœ‰å­—æ®µ...
  totalTransactions: number // æ€»äº¤æ˜“æ•°
  totalManualTransactions: number // ğŸ†• æ‰‹åŠ¨äº¤æ˜“æ•°
  totalRecurringTransactionRecords: number // ğŸ†• å®šæœŸäº¤æ˜“è®°å½•æ•°
  totalLoanTransactionRecords: number // ğŸ†• è´·æ¬¾ç›¸å…³äº¤æ˜“æ•°
  // å…¶ä»–å­—æ®µ...
}
```

### **2. æ•°æ®ç»Ÿè®¡è®¡ç®—**

åœ¨æ•°æ®å¯¼å‡ºæœåŠ¡ä¸­ï¼Œæ ¹æ®äº¤æ˜“çš„å…³è”å­—æ®µè¿›è¡Œåˆ†ç±»ç»Ÿè®¡ï¼š

```typescript
// src/app/api/user/data/export/route.ts
statistics: {
  totalTransactions: transactions.length,
  totalManualTransactions: transactions.filter(t =>
    !t.recurringTransactionId && !t.loanContractId && !t.loanPaymentId
  ).length,
  totalRecurringTransactionRecords: transactions.filter(t =>
    t.recurringTransactionId
  ).length,
  totalLoanTransactionRecords: transactions.filter(t =>
    t.loanContractId || t.loanPaymentId
  ).length,
  // å…¶ä»–ç»Ÿè®¡...
}
```

### **3. äº¤æ˜“åˆ†ç±»é€»è¾‘**

åŸºäºæ•°æ®åº“å­—æ®µè¿›è¡Œåˆ†ç±»ï¼š

| äº¤æ˜“ç±»å‹         | åˆ¤æ–­æ¡ä»¶                                                                               | è¯´æ˜         |
| ---------------- | -------------------------------------------------------------------------------------- | ------------ |
| **æ‰‹åŠ¨äº¤æ˜“**     | `recurringTransactionId = null` AND `loanContractId = null` AND `loanPaymentId = null` | ç”¨æˆ·ç›´æ¥åˆ›å»º |
| **å®šæœŸäº¤æ˜“è®°å½•** | `recurringTransactionId != null`                                                       | å®šæœŸäº¤æ˜“ç”Ÿæˆ |
| **è´·æ¬¾ç›¸å…³äº¤æ˜“** | `loanContractId != null` OR `loanPaymentId != null`                                    | è´·æ¬¾ç›¸å…³     |

### **4. é€‰æ‹©æ€§å¯¼å…¥é€»è¾‘**

åœ¨æ•°æ®å¯¼å…¥æœåŠ¡ä¸­ï¼Œæ ¹æ®ç”¨æˆ·é€‰æ‹©è¿‡æ»¤äº¤æ˜“ï¼š

```typescript
// src/lib/services/data-import.service.ts
const filteredTransactions = data.transactions.filter(transaction => {
  // æ‰‹åŠ¨äº¤æ˜“
  if (
    !transaction.recurringTransactionId &&
    !transaction.loanContractId &&
    !transaction.loanPaymentId
  ) {
    return options.selectedDataTypes?.manualTransactions !== false
  }
  // å®šæœŸäº¤æ˜“è®°å½•
  if (transaction.recurringTransactionId) {
    return options.selectedDataTypes?.recurringTransactionRecords !== false
  }
  // è´·æ¬¾ç›¸å…³äº¤æ˜“
  if (transaction.loanContractId || transaction.loanPaymentId) {
    return options.selectedDataTypes?.loanTransactionRecords !== false
  }
  return false
})
```

## ğŸ¨ **UIç•Œé¢è®¾è®¡**

### **æ˜¾ç¤ºæ•ˆæœ**

```
â˜‘ æ‰‹åŠ¨äº¤æ˜“                    450
    ä¾èµ–äº: accounts, tags
    ç”¨æˆ·ç›´æ¥åˆ›å»ºçš„äº¤æ˜“è®°å½•

â˜‘ å®šæœŸäº¤æ˜“è®°å½•                150
    ä¾èµ–äº: recurringTransactions
    ç”±å®šæœŸäº¤æ˜“è§„åˆ™è‡ªåŠ¨ç”Ÿæˆçš„äº¤æ˜“è®°å½•

â˜‘ è´·æ¬¾ç›¸å…³äº¤æ˜“                 52
    ä¾èµ–äº: loanContracts
    è´·æ¬¾å‘æ”¾ã€è¿˜æ¬¾ç­‰ç›¸å…³çš„äº¤æ˜“è®°å½•
```

### **ä¾èµ–å…³ç³»**

- **æ‰‹åŠ¨äº¤æ˜“**: ä¾èµ–è´¦æˆ·å’Œæ ‡ç­¾
- **å®šæœŸäº¤æ˜“è®°å½•**: ä¾èµ–å®šæœŸäº¤æ˜“è®¾ç½®
- **è´·æ¬¾ç›¸å…³äº¤æ˜“**: ä¾èµ–è´·æ¬¾åˆçº¦

## ğŸŒ **å›½é™…åŒ–æ”¯æŒ**

### **ä¸­æ–‡ç¿»è¯‘**

```json
{
  "data.import.statistics.transactions.manual": "æ‰‹åŠ¨äº¤æ˜“",
  "data.import.statistics.transactions.recurring": "å®šæœŸäº¤æ˜“è®°å½•",
  "data.import.statistics.transactions.loan": "è´·æ¬¾ç›¸å…³äº¤æ˜“",
  "data.import.selector.transactions.manual.desc": "ç”¨æˆ·ç›´æ¥åˆ›å»ºçš„äº¤æ˜“è®°å½•",
  "data.import.selector.transactions.recurring.desc": "ç”±å®šæœŸäº¤æ˜“è§„åˆ™è‡ªåŠ¨ç”Ÿæˆçš„äº¤æ˜“è®°å½•",
  "data.import.selector.transactions.loan.desc": "è´·æ¬¾å‘æ”¾ã€è¿˜æ¬¾ç­‰ç›¸å…³çš„äº¤æ˜“è®°å½•"
}
```

### **è‹±æ–‡ç¿»è¯‘**

```json
{
  "data.import.statistics.transactions.manual": "Manual Transactions",
  "data.import.statistics.transactions.recurring": "Recurring Transaction Records",
  "data.import.statistics.transactions.loan": "Loan-related Transactions",
  "data.import.selector.transactions.manual.desc": "Transaction records created directly by users",
  "data.import.selector.transactions.recurring.desc": "Transaction records automatically generated by recurring transaction rules",
  "data.import.selector.transactions.loan.desc": "Transaction records related to loan disbursements, repayments, etc."
}
```

## ğŸ“Š **æ•°æ®ç¤ºä¾‹**

### **å¯¼å…¥å‰ç»Ÿè®¡æ˜¾ç¤º**

```
æ•°æ®ç»Ÿè®¡:
åˆ†ç±»: 11        è´¦æˆ·: 23        æ‰‹åŠ¨äº¤æ˜“: 450
æ ‡ç­¾: 4         è´§å¸: 6         å®šæœŸäº¤æ˜“è®°å½•: 150
æ±‡ç‡: 31        äº¤æ˜“æ¨¡æ¿: 0     è´·æ¬¾ç›¸å…³äº¤æ˜“: 52
å®šæœŸäº¤æ˜“: 2     è´·æ¬¾åˆçº¦: 2     è¿˜æ¬¾è®°å½•: 396
```

### **ç”¨æˆ·é€‰æ‹©ç¤ºä¾‹**

ç”¨æˆ·å¯ä»¥é€‰æ‹©æ€§å¯¼å…¥ï¼š

- âœ… æ‰‹åŠ¨äº¤æ˜“ (450æ¡)
- âŒ å®šæœŸäº¤æ˜“è®°å½• (150æ¡) - ä¸å¯¼å…¥
- âœ… è´·æ¬¾ç›¸å…³äº¤æ˜“ (52æ¡)

æœ€ç»ˆåªå¯¼å…¥ 502 æ¡äº¤æ˜“è®°å½•ã€‚

## ğŸ”„ **å‘åå…¼å®¹æ€§**

### **æ—§æ•°æ®å¤„ç†**

- å¦‚æœå¯¼å…¥çš„æ•°æ®æ–‡ä»¶æ²¡æœ‰ç»†åˆ†ç»Ÿè®¡ï¼Œç³»ç»Ÿä¼šï¼š
  1. ä½¿ç”¨ `totalTransactions` ä½œä¸ºæ‰‹åŠ¨äº¤æ˜“æ•°é‡
  2. å°†å®šæœŸäº¤æ˜“è®°å½•å’Œè´·æ¬¾ç›¸å…³äº¤æ˜“æ•°é‡è®¾ä¸º 0
  3. é»˜è®¤é€‰æ‹©å¯¼å…¥æ‰€æœ‰äº¤æ˜“

### **APIå…¼å®¹æ€§**

- ä¿ç•™åŸæœ‰çš„ `totalTransactions` å­—æ®µ
- æ–°å¢çš„ç»†åˆ†å­—æ®µä¸ºå¯é€‰å­—æ®µ
- å¯¼å…¥é€»è¾‘å‘åå…¼å®¹æ—§ç‰ˆæœ¬çš„é€‰æ‹©é…ç½®

## âœ… **åŠŸèƒ½éªŒè¯**

### **æµ‹è¯•åœºæ™¯**

1. **å®Œæ•´å¯¼å…¥æµ‹è¯•**

   - é€‰æ‹©æ‰€æœ‰äº¤æ˜“ç±»å‹
   - éªŒè¯å¯¼å…¥æ•°é‡æ­£ç¡®

2. **é€‰æ‹©æ€§å¯¼å…¥æµ‹è¯•**

   - åªé€‰æ‹©æ‰‹åŠ¨äº¤æ˜“
   - éªŒè¯åªå¯¼å…¥æ‰‹åŠ¨äº¤æ˜“è®°å½•

3. **ä¾èµ–å…³ç³»æµ‹è¯•**

   - å–æ¶ˆé€‰æ‹©å®šæœŸäº¤æ˜“è®¾ç½®
   - éªŒè¯å®šæœŸäº¤æ˜“è®°å½•è‡ªåŠ¨å–æ¶ˆé€‰æ‹©

4. **ç»Ÿè®¡å‡†ç¡®æ€§æµ‹è¯•**
   - éªŒè¯å„ç±»å‹äº¤æ˜“ç»Ÿè®¡æ•°é‡æ­£ç¡®
   - éªŒè¯æ€»æ•°ç­‰äºå„åˆ†ç±»ä¹‹å’Œ

### **é¢„æœŸæ•ˆæœ**

1. **ç”¨æˆ·ä½“éªŒæå‡**

   - ç²¾ç¡®æ§åˆ¶å¯¼å…¥å†…å®¹
   - æ¸…æ™°çš„æ•°æ®åˆ†ç±»å±•ç¤º
   - æ™ºèƒ½çš„ä¾èµ–å…³ç³»å¤„ç†

2. **æ•°æ®å®Œæ•´æ€§**

   - å‡†ç¡®çš„äº¤æ˜“åˆ†ç±»
   - æ­£ç¡®çš„ä¾èµ–å…³ç³»éªŒè¯
   - å¯é çš„å¯¼å…¥è¿‡æ»¤é€»è¾‘

3. **ç³»ç»Ÿç¨³å®šæ€§**
   - å‘åå…¼å®¹æ—§æ•°æ®
   - é”™è¯¯å¤„ç†æœºåˆ¶å®Œå–„
   - æ€§èƒ½å½±å“æœ€å°

## ğŸš€ **éƒ¨ç½²æ¸…å•**

### **æ–‡ä»¶ä¿®æ”¹åˆ—è¡¨**

- âœ… `src/types/data-import.ts` - ç±»å‹å®šä¹‰æ‰©å±•
- âœ… `src/app/api/user/data/export/route.ts` - ç»Ÿè®¡è®¡ç®—
- âœ… `src/lib/services/data-import.service.ts` - å¯¼å…¥é€»è¾‘
- âœ… `src/components/features/settings/DataImportSelector.tsx` - UIç»„ä»¶
- âœ… `src/components/features/settings/DataManagementSection.tsx` - é»˜è®¤é€‰æ‹©
- âœ… `public/locales/zh/data.json` - ä¸­æ–‡ç¿»è¯‘
- âœ… `public/locales/en/data.json` - è‹±æ–‡ç¿»è¯‘

### **éªŒè¯æ­¥éª¤**

1. å¯¼å‡ºæ•°æ®æ–‡ä»¶ï¼Œæ£€æŸ¥ç»Ÿè®¡ä¿¡æ¯
2. å¯¼å…¥æ•°æ®æ—¶éªŒè¯é€‰æ‹©ç•Œé¢
3. æµ‹è¯•é€‰æ‹©æ€§å¯¼å…¥åŠŸèƒ½
4. éªŒè¯ä¾èµ–å…³ç³»å¤„ç†
5. æ£€æŸ¥å›½é™…åŒ–æ˜¾ç¤º

è¿™ä¸ªå®ç°å®Œå…¨æ»¡è¶³äº†ç”¨æˆ·çš„éœ€æ±‚ï¼Œæä¾›äº†ç²¾ç¡®çš„äº¤æ˜“ç±»å‹æ§åˆ¶ï¼ŒåŒæ—¶ä¿æŒäº†è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒå’Œç³»ç»Ÿç¨³å®šæ€§ã€‚
