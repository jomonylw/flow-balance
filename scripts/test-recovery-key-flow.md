# 恢复密钥功能测试流程

## 🧪 测试步骤

### 1. 注册流程测试

1. **访问注册页面**: http://localhost:3001/signup
2. **填写注册信息**:
   - 邮箱: `test-recovery@example.com`
   - 密码: `test123456`
   - 确认密码: `test123456`
3. **提交注册**
4. **验证跳转**: 应该跳转到恢复密钥展示页面 `/recovery-key-setup?from=signup`
5. **验证恢复密钥显示**:
   - 格式应为 `FB-XXXX-XXXX-XXXX-XXXX`
   - 有复制和下载按钮
   - 有确认保存的复选框
6. **测试复制功能**: 点击复制按钮，验证密钥是否复制到剪贴板
7. **测试下载功能**: 点击下载按钮，验证是否下载了文本文件
8. **确认保存**: 勾选确认框，点击"我已保存，继续"
9. **验证跳转**: 应该跳转到仪表板页面

### 2. 忘记密码流程测试

1. **退出登录**: 确保当前已退出登录
2. **访问忘记密码页面**: http://localhost:3001/forgot-password
3. **验证页面内容**:
   - 标题: "重置密码"
   - 副标题: "使用恢复密钥重置您的密码"
   - 邮箱输入框
   - 恢复密钥输入框
   - 提示信息
4. **测试输入验证**:
   - 空邮箱提交 → 应显示错误
   - 无效邮箱格式 → 应显示错误
   - 空恢复密钥 → 应显示错误
   - 无效恢复密钥格式 → 应显示错误
5. **测试正确验证**:
   - 邮箱: `test-recovery@example.com`
   - 恢复密钥: 使用注册时保存的密钥
   - 点击"验证并重置密码"
6. **验证跳转**: 应该跳转到重置密码页面 `/reset-password?token=xxx`

### 3. 重置密码流程测试

1. **验证页面内容**:
   - 标题: "设置新密码"
   - 新密码输入框
   - 确认密码输入框
2. **测试密码验证**:
   - 空密码 → 应显示错误
   - 密码长度不足 → 应显示错误
   - 两次密码不一致 → 应显示错误
3. **设置新密码**:
   - 新密码: `newtest123456`
   - 确认密码: `newtest123456`
   - 点击"重置密码"
4. **验证成功**: 应显示成功消息并跳转到登录页面

### 4. 新密码登录测试

1. **使用新密码登录**:
   - 邮箱: `test-recovery@example.com`
   - 密码: `newtest123456`
2. **验证登录成功**: 应该能够正常登录并进入仪表板

### 5. 安全设置中的恢复密钥管理测试

1. **访问安全设置**: http://localhost:3001/settings?tab=security
2. **验证恢复密钥管理区域**:
   - 显示当前恢复密钥（默认掩码显示）
   - 显示创建时间
   - 有显示/隐藏按钮
   - 有复制按钮
   - 有下载按钮
   - 有重新生成按钮
3. **测试显示/隐藏功能**: 点击眼睛图标切换显示状态
4. **测试复制功能**: 点击复制按钮
5. **测试下载功能**: 点击下载按钮
6. **测试重新生成功能**:
   - 点击"重新生成恢复密钥"
   - 应弹出确认对话框
   - 输入当前密码: `newtest123456`
   - 点击"重新生成"
   - 验证新密钥生成并显示

### 6. 错误场景测试

1. **无效恢复密钥测试**:
   - 使用错误的恢复密钥尝试重置密码
   - 应显示"邮箱或恢复密钥不正确"错误
2. **过期令牌测试**:
   - 等待30分钟后使用重置密码链接
   - 应显示"验证令牌无效或已过期"错误
3. **错误密码测试**:
   - 在重新生成恢复密钥时输入错误的当前密码
   - 应显示"当前密码不正确"错误

## ✅ 验证清单

### 功能验证

- [ ] 注册时自动生成恢复密钥
- [ ] 恢复密钥格式正确 (FB-XXXX-XXXX-XXXX-XXXX)
- [ ] 恢复密钥展示页面正常工作
- [ ] 复制功能正常工作
- [ ] 下载功能正常工作
- [ ] 忘记密码页面正常工作
- [ ] 恢复密钥验证正常工作
- [ ] 重置密码页面正常工作
- [ ] 新密码设置正常工作
- [ ] 安全设置中的恢复密钥管理正常工作
- [ ] 重新生成恢复密钥功能正常工作

### 安全验证

- [ ] 恢复密钥全局唯一
- [ ] 验证令牌有30分钟有效期
- [ ] 错误的恢复密钥被拒绝
- [ ] 过期的验证令牌被拒绝
- [ ] 重新生成需要当前密码验证

### 用户体验验证

- [ ] 所有文本正确显示（无 [object Object]）
- [ ] 按钮文字正确显示
- [ ] 输入框可以正常输入
- [ ] 错误提示友好且准确
- [ ] 成功消息清晰明确
- [ ] 页面跳转流畅
- [ ] 明暗主题切换正常
- [ ] 响应式设计在移动端正常

### 国际化验证

- [ ] 中文界面完整
- [ ] 英文界面完整
- [ ] 语言切换正常工作
- [ ] 所有翻译键正确加载

## 🐛 已知问题

### 已修复

- ✅ InputField 组件 onChange 属性类型不匹配
- ✅ 翻译函数返回 [object Object] 问题
- ✅ 按钮文字不显示问题
- ✅ 输入框无法输入问题

### 待观察

- 恢复密钥在 RecoveryKeyManagement 中获取用户邮箱的方式
- 长时间会话的令牌过期处理

## 📝 测试结果

测试日期: ****\_\_\_**** 测试人员: ****\_\_\_****

| 测试项目     | 状态 | 备注 |
| ------------ | ---- | ---- |
| 注册流程     | ⭕   |      |
| 忘记密码流程 | ⭕   |      |
| 重置密码流程 | ⭕   |      |
| 新密码登录   | ⭕   |      |
| 恢复密钥管理 | ⭕   |      |
| 错误场景处理 | ⭕   |      |

状态说明: ✅ 通过 | ❌ 失败 | ⭕ 待测试
